<!-- templates/auth/reset_password.html -->
{% extends "base.html" %}

{% block title %}Reset Password - ThriveOS{% endblock %}

{% block extra_js %}
<script>
    function validatePasswordStrength() {
        const password = document.getElementById('password').value;
        const strength = document.getElementById('password-strength');
        const requirements = document.getElementById('password-requirements');
        
        if (!password) {
            strength.innerHTML = '';
            return;
        }
        
        let score = 0;
        const checks = {
            length: password.length >= 8,
            lowercase: /[a-z]/.test(password),
            uppercase: /[A-Z]/.test(password),
            number: /\d/.test(password),
            special: /[^A-Za-z0-9]/.test(password)
        };
        
        score = Object.values(checks).filter(Boolean).length;
        
        let strengthText = '';
        let strengthColor = '';
        
        if (score <= 2) {
            strengthText = 'Weak';
            strengthColor = 'text-red-600';
        } else if (score <= 3) {
            strengthText = 'Fair';
            strengthColor = 'text-yellow-600';
        } else if (score <= 4) {
            strengthText = 'Good';
            strengthColor = 'text-blue-600';
        } else {
            strengthText = 'Strong';
            strengthColor = 'text-green-600';
        }
        
        strength.innerHTML = `<span class="${strengthColor} font-semibold">${strengthText}</span>`;
        
        // Update password strength bar
        const bar = document.getElementById('password-strength-bar');
        const width = (score / 5) * 100;
        bar.style.width = width + '%';
        bar.className = score <= 2 ? 'bg-red-600 h-1.5 rounded-full transition-all duration-300' :
                         score <= 3 ? 'bg-yellow-500 h-1.5 rounded-full transition-all duration-300' :
                         score <= 4 ? 'bg-blue-500 h-1.5 rounded-full transition-all duration-300' :
                         'bg-green-500 h-1.5 rounded-full transition-all duration-300';
        
        // Update requirement checks
        Object.entries(checks).forEach(([key, passed]) => {
            const element = document.getElementById(`req-${key}`);
            if (element) {
                element.className = passed ? 'text-green-600' : 'text-gray-500';
                element.querySelector('i').className = passed ? 
                    'fas fa-check-circle mr-2' : 'fas fa-times-circle mr-2';
            }
        });
    }
    
    function validatePasswordMatch() {
        const password = document.getElementById('password').value;
        const confirm = document.getElementById('confirm_password').value;
        const message = document.getElementById('password-match-message');
        
        if (password && confirm) {
            if (password === confirm) {
                message.innerHTML = '<span class="text-green-600"><i class="fas fa-check-circle"></i> Passwords match</span>';
                return true;
            } else {
                message.innerHTML = '<span class="text-red-600"><i class="fas fa-times-circle"></i> Passwords do not match</span>';
                return false;
            }
        } else {
            message.innerHTML = '';
            return false;
        }
    }
    
    function validateForm() {
        const password = document.getElementById('password').value;
        const confirm = document.getElementById('confirm_password').value;
        
        if (!password || !confirm) {
            alert('Please fill in all fields');
            return false;
        }
        
        if (password.length < 8) {
            alert('Password must be at least 8 characters long');
            return false;
        }
        
        if (!validatePasswordMatch()) {
            alert('Passwords do not match');
            return false;
        }
        
        return true;
    }
</script>
{% endblock %}

{% block content %}
<div class="min-h-[70vh] flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        <!-- Header -->
        <div class="text-center">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-4">
                <i class="fas fa-lock text-red-600 text-2xl"></i>
            </div>
            <h2 class="text-3xl font-extrabold text-gray-900">
                Create New Password
            </h2>
            <p class="mt-2 text-lg text-gray-600">
                Choose a strong password for your account
            </p>
            {% if error %}
            <div class="mt-4 p-3 bg-red-100 border border-red-200 rounded-lg">
                <p class="text-red-700">{{ error }}</p>
            </div>
            {% endif %}
        </div>
        
        <!-- Reset Password Form -->
        <form class="mt-8 space-y-6" action="{{ url_for('auth.reset_password', token=token) }}" method="POST" id="resetPasswordForm" onsubmit="return validateForm()">
            <!-- New Password -->
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">
                    New Password
                </label>
                <input id="password" name="password" type="password" required
                       class="appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 focus:z-10 sm:text-sm form-input"
                       placeholder="••••••••"
                       onkeyup="validatePasswordStrength(); validatePasswordMatch();">
                
                <!-- Password Strength -->
                <div class="mt-2">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">Password strength:</span>
                        <span id="password-strength" class="text-sm"></span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                        <div id="password-strength-bar" class="h-1.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Password Requirements -->
                <div id="password-requirements" class="mt-3 space-y-1">
                    <p class="text-xs font-medium text-gray-700 mb-1">Requirements:</p>
                    <div class="flex items-center text-xs" id="req-length">
                        <i class="fas fa-times-circle mr-2 text-gray-500"></i>
                        <span>At least 8 characters</span>
                    </div>
                    <div class="flex items-center text-xs" id="req-lowercase">
                        <i class="fas fa-times-circle mr-2 text-gray-500"></i>
                        <span>One lowercase letter</span>
                    </div>
                    <div class="flex items-center text-xs" id="req-uppercase">
                        <i class="fas fa-times-circle mr-2 text-gray-500"></i>
                        <span>One uppercase letter</span>
                    </div>
                    <div class="flex items-center text-xs" id="req-number">
                        <i class="fas fa-times-circle mr-2 text-gray-500"></i>
                        <span>One number</span>
                    </div>
                    <div class="flex items-center text-xs" id="req-special">
                        <i class="fas fa-times-circle mr-2 text-gray-500"></i>
                        <span>One special character</span>
                    </div>
                </div>
            </div>
            
            <!-- Confirm Password -->
            <div>
                <label for="confirm_password" class="block text-sm font-medium text-gray-700 mb-1">
                    Confirm New Password
                </label>
                <input id="confirm_password" name="confirm_password" type="password" required
                       class="appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 focus:z-10 sm:text-sm form-input"
                       placeholder="••••••••"
                       onkeyup="validatePasswordMatch();">
                <p id="password-match-message" class="text-sm mt-1"></p>
            </div>
            
            <!-- Security Info -->
            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-shield-alt text-green-400"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-green-800">Secure Connection</h3>
                        <div class="mt-2 text-sm text-green-700">
                            <p>Your password reset is encrypted and secure. Use a strong, unique password.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div>
                <button type="submit"
                        class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 btn-primary">
                    <span class="absolute left-0 inset-y-0 flex items-center pl-3">
                        <i class="fas fa-save"></i>
                    </span>
                    Update Password
                </button>
            </div>
            
            <!-- Back to Login -->
            <div class="text-center">
                <a href="{{ url_for('auth.login') }}" class="font-medium text-red-600 hover:text-red-500">
                    <i class="fas fa-arrow-left mr-1"></i>
                    Back to Login
                </a>
            </div>
        </form>
        
        <!-- Performance Indicator -->
        <div class="mt-8">
            <div class="flex items-center justify-center space-x-2">
                <div class="loader"></div>
                <span class="text-sm text-gray-600">Processing with maximum security & speed</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}